## 一、概述

### 1. 网络概述

#### 1.1 三大类网络

- 电信网络
- 有线电视网络：一般覆盖范围为一个小区
- 计算机网络

三网融合：现在一般通过电信网络连接进入互联网



### 2. 互联网概述

#### 2.1 互联网和互连网

- 互联网：
  - Internet，专用名词
  - 特指使用TCP/IP协议的网络
- 互连网：
  - internet，通用名词，泛指由多个不同类型的计算机网络连接而形成的网络
  - 可使用任何协议



#### 2.2 多层级ISP

(Internet Service Provider)

<img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210717163816176.png" alt="image-20210717163816176" style="zoom: 50%;" /> 



### 3. 互联网的组成

- 边缘部分
- 核心部分



#### 3.1 边缘部分

1. 边缘部分的主机又称为端系统

2. 边缘部分之间的通信方式：主机间的通信即为进程与进程间的通信。其分为：

   - 客户-服务器 C/S

     - 服务器和客户端其实指的是进程，而非主机
     - 服务器主机上可以使用其他而成为其他服务的客户端，但此服务器主机始终是这个服务的服务端

   - 对等通信 P2P

     - 不区分服务器和客户端

     - 既可以做这个服务的客户端，也可以做这个服务的服务端

       <img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210717170027953.png" alt="image-20210717170027953" style="zoom:50%;" /> 



#### 3.2 核心部分

1. 核心器件：路由器

2. 核心功能：（由路由器实现）分组交换

   > 电路交换：
   >
   > - 两两交换=>交换机
   > - 通讯之前建立连接，相当于专线，通讯之间的数据包不用写地址
   > - 缺点：
   >   - 计算机通信直接有突发性
   >   - 通信线路利用率低
   >
   > 分组交换：
   >
   > - 添加首部构成分组
   > - 分组中有地址等成分，每个分组都是独立的
   > - 存储转发：在每个路由器都会暂存，再查找路由表寻找下一跳地址
   > - 优点：
   >   - 高效
   >   - 灵活
   >   - 迅速
   >   - 可靠
   > - 缺点：
   >   - 排队时延
   >   - 首部空间
   >
   > 报文交换：
   >
   > - 不分组
   > - 由中转站转发
   >
   > <img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210717201547028.png" alt="image-20210717201547028" style="zoom:50%;" /> 



### 4. 网络分类

- 广域网WAN：城市与城市之间，一般由运营商架构；通常说花钱买带宽都为广域网
- 城域网MAN
- 局域网LAN：公司、学校等
- 个人区域网PAN



### 5. 性能指标

- 速率：数据的传送速率，平均每秒钟发送的比特数
  - 比特：一个二进制数字，即0/1

- 带宽：

  - 含义一：频带宽度，即频率差，单位通常为赫兹

  - 含义二：计算机中通常称最高传送速率

    - 因为存在分组交换，每个分组之间有时间间隔，所以速度会低于带宽

    - 带宽越高 速度越快 越不稳定

- 吞吐量：单位时间内 通过网络的数据量（双向）

- 时延：从发送端开始发送 到接收端完全接收的时间（=发送时延+传播时延+处理时延+排队时延）

  - 发送时延：从发送数据帧的第一个比特算起， 到该帧的最后一个比特发送完毕 所需的时间。
    - 可以改变网卡带宽 减少发送时延
  - 传播时延：到最后一比特进入网卡
  - 处理时延：路由器中查路由表等
  - 排队时延：路由器中排队

- 时延带宽积

- 往返时间

- 利用率：发送数据的时间/总时间

  - 信道利用率：对信道来说

    - 信道利用率增大，时延增大

      <img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210718215709956.png" alt="image-20210718215709956" style="zoom:50%;" /> 

  - 网络利用率：对网卡来说，即所有信道的利用率相加



### 6. 计算机网络体系结构

#### 6.1 协议

**三个组成要素：**

- 语法：结构/格式
- 语义：填入的信息的含义
- 同步：事件实现顺序



**每层的协议：**

- 应用层：传输文件
  - HTTP、ICMP、POP3、FTP、SMTP、DNS
  - 作用范围为两个主机
- 传输层：传输段
  - TCP、UDP
  - 确保可靠传输
  - 为应用层协议提供服务
  - 作用范围为两个主机

- 网络层：传输数据包
  - IPV4、IPV6
  - 为传输层协议提供服务
  - 作用范围为两个主机及中间的路由器
- 数据链路层：传输帧
  - CSMA
  - 作用范围为路由器一个端口到另一个端口
  - 为网络层提供服务



#### 6.2 OSI参考模型

- 应用层：进程间通信
- 表示层：
  - 字符转换：将要传的数据按照字符集的规则变成01
- 会话层：不同主机上建立会话连接
- 传输层：负责可靠传输、流量控制、拥塞避免等
- 网络层：规划ip地址等
- 数据链路层：链路中数据传输
- 物理层



#### 6.3 TCP/IP体系结构

<img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210722203437756.png" alt="image-20210722203437756" style="zoom: 67%;" /> 



## 二、物理层

### 1. 数据通信基础知识

#### 1.1 信号

信息->数据->信号->数据->信息



##### 1.1.1 分类：

- 数字信号：离散0/1
  - 码元
- 模拟信号：连续



#### 1.2 信道

##### 1.2.1 通信方式

- 单工通信：如收音机与电台之间
- 半双工通信：双向交替通信，但是不能同时收发，如对讲机
- 全双工通信：双向同时通信，可以同时收发



##### 1.2.2 信号分类

- 基带信号：往往频率较低，且不适于在信道上传输
- 带通信号：基带信号经过**调制**，就成为了带通信号，适合在信道上传输
  - 调制分类：
    - 基带调制：调制后仍为基带信号，又叫做编码
      - 归零制
      - 不归零制
      - 曼彻斯特编码
      - 差分曼彻斯特编码：信号中间一定跳，遇到0前面就跳，遇到1前面就不跳
    - 带通调制：调制后为带通信号，又叫做调制载波
      - 调幅
      - 调频
      - 调相：调用正弦波或者余弦波等
  - <img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210803200855035.png" alt="image-20210803200855035" style="zoom: 40%;" /> 



> 注：
>
> 基带信号、带通信号
>
> 模拟信号、数字信号
>
> 可以两两组合



##### 1.2.3 信道的极限容量

- 带宽：模拟信号能通过信道的频率范围，例如：3300 - 300 = 3000
- 信噪比



### 2 信道复用技术

#### 2.1 频分复用

模拟信号



以频率划分信道，不同的频率传输不同的用户信息



#### 2.2 时分复用

数字信号



划分时间为时分复用帧（TDM帧），每个用户占用帧中固定序列号的时隙



#### 2.3 统计时分复用

动态分配时隙，而不是固定每个用户的时隙

可以减少时分复用中不适用信道的浪费



实现时每个数据要加上用户标记



#### 2.4 波分复用

光信号



根据光的波长不同，用不同波长的光承载不同信道的通信

如：红光用于AB之间通信，蓝光用于CD之间通信



波分复用同时也是光的频分复用



#### 2.5 码分复用

即码分多址，用于无线信号



多用于基站和手机之间通信



- 每个用户一个固定n位码片序列，发送1为码片原码，0为码片反码。
  - 码片序列之间满足正交关系
    - A与其他码片格式化内积结果为0
    - A与A格式化内积结果为1
    - A与-A格式化内积结果为-1

- 信号由多个用户的码片叠加而成

- 用户收到信号后和自己的码片做格式化内积（相乘相加/n），得到1/-1/0，对应1/0/没有收到信号



### 3.宽带接入技术

即互联网接入技术



#### 3.1 ADSL技术

有线宽带接入技术，对普通电话线进行改造，使其能承载宽带业务

将低频留给电话使用，将高频留给用户上网使用

- 频分复用 模拟信号
- 高频区又分为上行和下行，上下行不对称



#### 3.2 光纤同轴混合网

对有线电视网进行改造，将骨干网的同轴电缆换成光纤，形成光纤同轴混合网



#### 3.3 FTTx技术

实现光纤到户



#### 3.4 移动互联网技术

通过基站接入互联网

4G 5G



## 三、数据链路层

### 1. 数据链路

#### 1.1 分类

数据链路=协议+链路



分类：

- 点对点信道
- 广播信道



#### 3.1.2 协议需要完成的问题

- **封装成帧**：在数据前后分别加上头部和尾部构成帧，表示帧的开始和结束
- **透明传输**：不管输入的内容是什么都可以放在帧中传递，即需要解决帧内部出现开始/结束标志时的帧定界错误
  - 字节/字符填充：用转义字符填充，填充的范围为：开始标志、结束标志、转义标志
- **差错检测**：保证传输的可靠性。一般使用循环冗余技术CRC
  - 循环冗余技术：
    - 帧检验序列FCS
      - 一般放于帧的数据部分和帧结束符之间
      - 生成：原始数据+n位/n+1位除数=n位冗余码
      - 检测：原始数据+n位冗余码/n+1位除数=0
    - 不足：
      - 出现错误还是可能判断没有错误
      - 只能检测出有无错误，不能检测错误位置
      - 不能实现无差错传输/可靠传输



> =》帧结构：首部+数据部分+尾部



### 2. 点对点协议PPP协议

#### 2.1 组成

- 封装成帧的方法
- LCP
- NCP



#### 2.2 帧格式

封装成帧+差错检验：

- 首部：四个字段

  - F：开始/结束标识符，7E

  - A：地址，FF

    > 实际此协议不需要MAC地址，因为只有一条链路

  - C：控制字段，03

  - 协议：指明帧中信息是什么

- 数据包

- 尾部

  - FCS
  - F：开始/结束标识符，7E



透明传输：

- 异步传输：把一个帧拆分为一个字节一个字节传输，采用字符填充
  - 开始和结束标识为7E，转义字符为7D
- 同步传输：一个帧一起发，采用零比特填充
  - 遇到5个1插入一个0，以防内部出现7E中的6个1



#### 2.3 工作过程

链路建立，即PPP协议初始化时会有的过程



- LCP协商：协商端口参数

  - LCP协商时，也采用PPP帧

- PAP认证：身份认证

  > 还有一种认证方式为CHAP认证
  >
  > - PAP认证：明文传输，认证用户名和密码是否正确
  > - CHAP认证：生成MD5码传输，另一端从数据库中拿出用户名和密码生成哈希值，和传来的随机数等算出MD5 对比两个MD5码是否一致

- NCP协商：协商网络参数

  - TCP/IP协议：IPCP协商，协商ip地址是否合法且在一个网段

- 最后才发生网络数据包，协议为IP协议





### 3. CSMA/CD协议

#### 3.1 组成

- 载波监听：在发送信号之前检测是否链路上是否已经有信号
- 多点接入：多个计算机连在同一根总线上
- 碰撞检测：边发送边监听是否有冲突
  - 以太网最短帧：
    - 保证在碰撞检测时能检测出碰撞，即要保证在最开始的信息到达之前信息仍在发送
    - 帧长：往返时间（$2τ$）*带宽（以太网最长为5KM，最短帧>=64b）
  - 冲突解决办法：退避算法：截断二进制指数退避
    - 确定基本退避时间：$2τ$ 即两倍争用期
    - 根据重传次数选取随机数r，等待$2τ*r$时间发送



### 4. 以太网

最开始认为 使用CSMA/CD协议的即为以太网

到交换机出现之后 把没有使用CSMA/CD协议的网络也叫做以太网



#### 4.1 MAC帧格式

- 首部：
  - 目标MAC地址
  
    > 此地址不一定是目标主机的mac地址
    >
    > - 如果目标主机在一个网段下，则目标mac地址为目标主机的mac地址
    > - 如果不在一个网段，则为网关的mac地址
  
  - 源MAC地址
  
  - 类型：帧类型
- 数据包：
  - 最大长度为1500字节，超出则拆分
  - 最小长度为46字节，不够则填充
    - 网络层首部会有数据长度，可以辨别出数据链路层填充的字节
- 尾部：
  - FCS



物理层在最前面加入：

- 前同步码：
- 帧开始定界符



没有帧结束定界符：因为使用曼彻斯特编码



如果收到无效帧则直接扔掉



#### 4.2 信道利用率

利用率=发送数据时间/整个时间



#### 4.3 网卡

工作流程：

cpu和存储器和网卡之间并行通信，发送ip地址等信息

网卡发送数据为串行通信



功能：

- 数据链路层
- 物理层



#### 4.4 MAC地址

每个网卡都需要一个MAC地址

48位，全球唯一



组成：

- 组织唯一标识符
- 扩展标识符



由于MAC地址的不同，帧又可以分为以下三种：

- 单播帧：网卡会和自己的MAC地址进行对比，如果相同则接收，不同则丢弃
- 广播帧：MAC地址为全1的帧
- 多播帧



### 5. 扩展以太网

#### 5.1 集线器

- 增加集线器，使小的冲突域变成大的**冲突域**
- 如果距离较远，还可以用光纤连接两个集线器，实现距离上的扩展



#### 5.2 网桥

增加**mac地址表**：实现mac地址和接口的多对一关系，优化冲突域

mac地址表可以自动构造（学习）



#### 5.3 交换机

接口为全双工状态，不用CSMA/CD协议

交换机连接的域为**广播域**



生成树协议：

- 根端口
- 指定端口
- 备用端口



#### 5.4 虚拟局域网VLAN

- port-vlan
- tag-vlan/trunk





## 四、网络层

### 1. IP地址和子网划分

#### 1.1 子网掩码

**作用：**

区分网络地址和主机地址



**使用：**

ip地址与子网掩码做与运算，得出自己所在网段（结果为网络地址不变，主机位全为0

- 与运算：
  - 1 1 = 1
  - 0 1 = 0
  - 0 0 = 0



**应用场景：**

计算机通信前要先判断目标地址和自己的IP地址是否在一个网段

> 此时计算机不知道目标地址的子网掩码，计算机用自己的子网掩码与目标IP地址得出目标IP地址所在网段

- 如果在一个网段 则会把mac地址填为目标主机mac地址 不会把数据包给网关（ARP协议找mac地址，可以跨交换机寻找
- 如果不在一个网段 则会把mac地址填为网关mac地址 把数据包给网关



**思考：**

虚拟局域网技术 只是在交换机上增加配置 

不会改变arp协议，即mac帧中的目标mac地址不会被更改



> 具体：先和子网掩码做与运算，得出目标ip地址的网段
>
> - 外网
>   - 目标mac地址为网关mac地址
>   - 网关一般在三层设备上，数据包到达三层设备后，三层设备查询路由表，找到下一跳mac地址
>
> - 内网
>
>   - 通过ARP协议找到mac地址
>   - 通过交换机上的mac地址映射表，找到对应接口（可能需要转发到另一个交换机
>   
>   port-vlan和tag-vlan：
>   
>   - 没有任何额外协议的情况下，局域网内同一网段的主机之间可以通信
>   - vlan的作用：**尽管**不同网段间的主机本身就不能通信，但是还是有可能造成广播风暴，一个vlan就是一个广播域
>     - port-vlan：不同交换机能划分相同vlan
>     - tag-vlan：使两个交换机之间一根线可以通过多个vlan（按道理来说配置port-vlan时，是把接口划入vlan中
>   - 不同网段/不同vlan间通信，只能依靠三层设备



#### 1.2 IP地址层次结构

> IP地址和mac地址：
>
> - IP地址指向起点和终点
> - mac地址相当于找路，寻找正确的交换机和路由器，最终到达目的主机



**IP地址组成：**

4字节 4 x 8 = 32位

- 网络标识
- 主机标识



#### 1.3 IP地址分类

<img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210811195740983.png" alt="image-20210811195740983" style="zoom:50%;" /> 

- A类地址：
  - 网络段：
    - 2^7 - 1个 
    - 范围为 1-126
    - 全0不能用 全1为保留网段
  - 主机位：
    - 2^8 * 2^8 * 2^8 - 2
    - 范围为 0 - 166777216
    - 全0为网络地址（网段） 全1为广播地址

- B类地址：
  - 网络段：范围为128-191
- C类地址：
  - 网络段：范围为192-223
- E类地址：
  - 网络段：范围为224-239



<img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210811201525635.png" alt="image-20210811201525635" style="zoom:33%;" /> 



**特殊的IP地址总结：**

网络地址除A类不能全1，其他类都可以全1（在规定了前缀的前提下

网络地址不能全0



主机地址不能为全0（网段地址

主机地址不能为全1（广播地址，mac地址为FF FF FF FF FF FF



其他地址：

- 127.0.0.1 环回地址，即本机地址
  - 访问此地址时 不通过网卡
- 169.254.0.0 没有配置DHCP时，自动获取这个网段的地址
- 0.0.0.0 IP地址和其他计算机的IP地址冲突，本机看自己的IP地址为0.0.0.0



#### 1.4 公网和私网地址

公网地址：全球统一，不能冲突

私网地址：

<img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210811212220440.png" alt="image-20210811212220440" style="zoom:50%;" /> 



#### 1.5 子网划分

借用现有网段的主机位划分子网位，划分出多个子网（即在ABC三类下再划分小的网段

- 等长子网划分
- 变长子网划分
  - 找大于 划分值+2 最小的2的倍数2^n
  - 从左往右数，前n位依次为0，其他位为1
    - 如点到点网络：只需要两位，即2+2 <= 2^2
    - 从左到右将前两位改为0，即其他六位都为子网掩码11111100 = 255 - 3 = 252



#### 1.6 超网（合并网段

子网掩码向左移动，合并网段



### 2. 静态和动态路由

#### 2.1 网络层实现的功能

网络层功能的讨论：

- 面向连接：即实现可靠传输
  - 在连接之前先建立虚电路（即逻辑连接）
  - 建立连接后所有数据包都经过这条链路，保证可靠传输
- 无连接：不可靠传输
  - 独立传输，不进行编号
  - 转发路径不确定，由路由器实时选择



#### 2.2 路由分类

- 直连路由：即路由口的ip对应此接口
- 静态路由
- 动态路由



若网段有多个路由来源，则选择优先级最高的放入路由表中





### 3. 网络层协议



### 4. NAT和MPLS



### 5. IPV6





## 五、传输层



## 六、网络层

### WWW

#### 1. www

网站的超链接



#### 2. URL

标识互联网上的唯一文档

格式：<协议>://<主机或域名>:<端口>/<路径>

- 协议：http ftp等
- 有时还能加入其他字段 如ftp连接里面还可以加上用户名密码等



#### 3. HTTP协议

**特点**

- TCP保证传输层的可靠传输
- 无连接：通信双方在交换http报文之前不需要先建立http连接
  - 对应无状态，无需考虑请求之间的任何关系
- 无状态：即服务器不会记录客户端访问，不存储客户的状态信息



**要求**

服务器必须按照客户端请求的先后顺序依次回送相应的结果，以保证客户端能够区分出每次请求的响应内容



##### 3.1 HTTP1.0 

**过程**

背景：服务端进程监听TCP的80端口，等待客户端建立连接

1. 客户端收到建立连接请求，建立TCP连接
2. 客户端发送请求报文
3. 服务端响应报文，返回响应页面
4. TCP连接释放

> 短连接：请求一次之后马上断开TCP连接，下次请求需重新建立TCP连接



**问题**

- 无法复用连接，每次建立连接开销大，降低网络利用率
- 队头阻塞：即上一个请求的响应到达之后下一个请求才能发出





**实例**

套接字编程，使用Socket进行http请求：

- <img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210726133558601.png" alt="image-20210726133558601" style="zoom: 45%;" /> 

- 代码示例：

  <img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210726133127450.png" alt="image-20210726133127450" style="zoom: 67%;" /> 

  



##### 3.2 HTTP1.1 

**与1.0的区别：**

1. 长连接：服务器发送响应后一段时间内仍然保持连接，即一次TCP连接可以供多轮使用（在同一个服务器上的资源）
   - 非流水线方式：客户端收到前一个响应之后才能发出下一个请求
   - 流水线方式：可以持续发送请求
2. 管道化：即相当于先进先出队列的迁移，发送到对方的时候依旧是有序的，但依然效率较低



##### 3.3 代理服务器

**概念：**

代理服务器是一种高速缓存，将最近的一些请求和响应暂存到代理服务器的本地磁盘中

新请求到达时，若发现与暂存的请求相同，就直接返回暂存的请求



应用：

- 提高访问速度

- 控制流量
- 绕过防火墙



##### 3.4 HTTP报文结构

请求报文：客户端向服务器发送请求

- 方法：GET POST等



响应报文：服务器响应客户端

- 状态码：三位数字



##### 3.5 Cookie

因为http协议的无状态特性，所以增加了cookie用来保存用户的身份



流程：

- 首次访问某个站点时，服务器生成一个唯一的识别码
- 服务器在响应报文中的Set-cookie字段放入识别码
- 客户端收到后 存入缓存/硬盘，放入主机名和识别码
- 客户端在以后的同类请求（默认）中都会加上cookie
  - 同类请求：资源路径相同的请求（URL=资源路径+资源名称）



应用场景：

- 跟踪用户行为/访问过的页面
  - 不一定登陆，登陆后需跟个人信息等关联
  - 将cookie存入后端数据库，并保存跟踪记录
  - 将cookie存入客户端的硬盘中
  - 更改携带cookie的domain域和path路径
- 登陆时记住密码（保存用户名和密码）



> cookie相当于在无状态的http协议上建立了一层用户会话层



##### 3.6 Session



流程：

- 前端发送用户名和密码到后端
- 后端经过验证后生成sessionId，并将sessionId放入cookie中
- 后端存储session（要进行登陆认证）
- 前端访问带上session（通过登陆认证）



应用场景：

- 前后端鉴权



##### 3.7 缓存机制

###### 缓存资源存储

- 硬盘缓存：css等文件，因为只需要加载一次即可渲染，不需要反复加载
- 内存缓存：js等脚本文件，可能随时需要执行



###### 三级缓存原理

- 先到内存中寻找资源
- 如果没有资源再到硬盘中寻找
- 如果没有就向目标网站发出请求
- 将请求存入内存和硬盘，并加载到页面



###### 缓存分类

- 强缓存
  - expires：
    - 用于http1.0
    - 存储过期的绝对时间，但当客户端和服务器时间偏差较大时，会导致缓存混乱
  - cache-control/max-age：
    - 用于http1.1
    - 存储过期的相对时间，相对于请求的时间
  - 可以同时使用，同时使用时后者优先级更高
- 协商缓存
  - last-modified/if-modified-since：
    - 服务端返回客户端服务器上 上一次文件修改时间
      - 如果服务器上此时间之后没有修改 则返回304，客户端将在缓存中加载资源并显示
      - 如果修改则返回200 并将旧资源移除，新资源放入缓存
  - etag/if-none-match：服务端返回客户端校验码
  - 可以同时使用，同时使用时后者优先级更高



###### 缓存机制

- 判断是否命中强缓存，若命中则直接从缓存中加载资源
- 如果没有名字强缓存，则判断是否命中协商缓存，若命中则直接从缓存中加载资源
- 如果都没有命中则保存并加载新资源（如果返回新资源会在协商缓存结果中，所以此时不需要再请求新资源）



#### 4. 万维网文档

