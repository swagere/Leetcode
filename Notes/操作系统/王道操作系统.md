## 一、引论

### 1. 计算机系统组成

- 应用程序
- 操作系统
- 硬件



### 2. 操作系统作用

- 为硬件提供资源管理功能
  - 处理机管理
  - 存储器管理
  - 文件管理
  - 设备管理
- 为应用程序提供接口
  - 用户接口
    - 命令接口
    
      > 用户直接使用
    
      - 联机命令接口（交互式）：一句一句的输入和执行
      - 脱机命令接口（批处理）：一段一段的输入和执行
    
    - 程序接口：由一组系统调用组成
    
      > 程序调用，程序直接使用
  - 图形用户界面
  
- 对硬件机器实现拓展



### 3. 操作系统特征

- 并发：

  > 并行：一个时刻可以同时运行多个任务
  >
  > 串行：一个时刻只运行一个任务
  >
  > 并发：宏观上并行，微观上串行 
  >
  > 
  >
  > 单核cpu是串行的，多核CPU可以同时运行的进程数和核数相等

- 共享：系统中的资源可以供多个并发执行的进程共同使用

  - 互斥共享：一个时间段，资源只允许一个进程使用
  - 同时共享：一个**时间段**，资源允许多个进程使用（并发/并行都可能发生，如文件传输/听歌和打游戏）

- 虚拟：

  - 空分复用技术
  - 时分复用技术

- 异步：



### 4. 操作系统发展（b

- 主机完全控制输入输出
- 单道批处理系统
- 多道批处理系统
- 分时系统
- 实时系统



### 5. 操作系统运行机制

#### 5.1 指令

指令：操作系统能识别并执行的最基本的命令



分类：

- 特权指令
- 非特权指令



#### 5.2 处理器状态

- 用户态：CPU只能执行非特权指令
- 核心态：执行特权/非特权指令



用程序状态字寄存器的标志位来标识当前处理机的状态



**转换：**

- 用户态转换到核心态的切换由且只能由中断完成
- 核心态转换为用户态 通过更改程序状态字标志位完成



#### 5.3 程序分类

- 内核程序：运行在核心态，实现**操作系统内核**功能的程序即为内核程序

  > 操作系统内核：运行在操作系统最底层
  >
  > - 时钟管理
  > - 中断处理
  > - 原语
  > - 对系统资源进行管理的功能
  >   - 进程管理
  >   - 存储器管理
  >   - I/O设备管理等
  >
  >  
  >
  > 操作系统体系结构：
  >
  > - 大内核：四个部分都包括
  >
  > - 微内核：只包括前三个部分
  >
  > 

- 应用程序：运行在用户态



### 6. 中断和异常

中断机制诞生于实现多道程序并发运行

本质：发生中断就意味着操作系统要介入，开展管理工作



#### 6.1 中断过程

- 进程向CPU发出中断信号
  - 计时部件发出中断信号
  - 进程发出系统调用（内中断信号）
  - I/O设备发出I/O完成的中断信号
- CPU切换到核心态，把CPU使用权限交给操作系统
- 操作系统内核对中断信号进行处理
  - 时间片用完，切换到下一个进程
  - 操作系统让I/O设备开始工作，并让当前进程暂停，切换到下一个进程
  - 操作系统让上一个进程恢复运行
- 操作系统把CPU使用权限交还给用户进程，另一个进程开始执行



#### 6.2 中断分类

##### 6.2.1 内中断/异常

中断信号的来源为CPU内部，与当前执行的指令有关



分类：

- 自愿/指令中断：如系统调用等
- 强迫中断：
  - 硬件故障：如缺页
  - 软件中断：如整数/0



##### 6.2.2 外中断

中断信号的来源为CPU外部，与当前执行的指令无关



分类：

- 外设请求：如I/O设备完成操作
- 人工干预：如用户强制终止一个进程



### 7. 系统调用

应用程序通过系统调用来请求操作系统的服务

> 防止应用程序可以随意使用系统资源而造成问题



**系统调用和库函数的区别：**

应用程序通过调用库函数 从而完成系统调用

- 库函数相当于是对系统调用的一个封装，但不是所有库函数都进行了系统调用，如读取一个值的绝对值
- 库函数屏蔽掉了系统调用的一些具体细节
- 而系统调用又屏蔽了硬件操作的细节

<img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210806185537857.png" alt="image-20210806185537857" style="zoom:50%;" /> 



**系统调用发生过程：**

以程序为例，翻译成机器码后：

- 用户态下：
  - 把参数装入寄存器
  - 发出中断（即系统调用）
- 核心态：
  - 操作系统内核处理中断



即发出系统调用为用户态，处理系统调用为核心态





## 二、进程

### 1. 进程

#### 1.1 进程定义

进程的引出：为了实现多个程序并发执行



#### 1.2 进程的组成

单个进程

- PCB：操作系统用于管理进程的信息，是进程存在的唯一标识
  - 进程描述信息
    - 进程标识符PID
      - 进程创建时 os分配
      - 用来标识进程是独一无二的
    - 用户标识符UID
  - 进程管理和控制信息
  - 资源分配清单
  - 处理机相关信息
- 程序段：存放程序代码
- 数据段：程序运行时使用、产生的运算数据



#### 1.3 进程的组织

多个进程

- 链接方式：按照进程状态分为多个队列
  - 操作系统指针：
    - 执行指针
    - 就绪队列指针
    - 阻塞队列指针
- 索引方式：根据进程状态不同，建立多张索引表，索引表项中存放的是PCB的地址
  - 操作系统指针：
    - 执行指针
    - 就绪表指针
    - 阻塞表指针



#### 1.4 进程特征

- 动态性
- 并发性
- 独立性：进程是资源分配，接受调度的基本单位 
- 异步性：可能会导致执行结果的不确定性
- 结构性



#### 1.5 进程状态

**五种状态：**

- 运行态：占用CPU资源，正在运行的进程
- 就绪态：已经具备运行条件，但CPU未空闲（拥有除处理机外所有的资源，一旦获得处理机，该进程就可以开始执行
- 阻塞态：等待某个事件发生

- 创建态：进程正在被创建，正在被分配资源、初始化等
- 终止态：进程正在撤销，操作系统会回收资源等



**进程状态的转换：**

<img src="C:\Users\12505\AppData\Roaming\Typora\typora-user-images\image-20210809215239466.png" alt="image-20210809215239466" style="zoom: 43%;" />  







## 三、内存





## 四、文件





## 五、I/O设备



